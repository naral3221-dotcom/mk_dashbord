# Work Log - 2026-02-10

---

## [10:00] Sprint 1 - Core Domain 엔티티 + Repository 인터페이스

### 요청
> Sprint 1 Core Domain 구현: 6개 엔티티(Organization, User, AdAccount, Campaign, CampaignInsight, Conversion) + 6개 Repository 인터페이스를 TDD로 구현

### 수행 내역
| 단계 | 에이전트 | 결과 |
|------|---------|------|
| 아키텍처 설계 | architect | ✅ 설계 문서 완성 |
| 공통 타입 | test-writer + implementer | ✅ types.ts + 10 tests |
| Organization | test-writer → implementer | ✅ 33 tests 통과 |
| User | test-writer → implementer | ✅ 22 tests 통과 |
| AdAccount | test-writer → implementer | ✅ 23 tests 통과 |
| Campaign | test-writer → implementer | ✅ 25 tests 통과 |
| CampaignInsight | test-writer → implementer | ✅ 39 tests 통과 (8 computed KPIs) |
| Conversion | test-writer → implementer | ✅ 21 tests 통과 |
| Repository 인터페이스 | implementer | ✅ 6개 인터페이스 정의 |
| TypeScript 검증 | - | ✅ tsc --noEmit 통과 |

### 테스트 결과
- **8 test files, 174 tests, ALL PASSED**
- Duration: ~2.2s

### 변경 파일
**생성:**
- `src/domain/entities/types.ts` - 도메인 enum + 상수
- `src/domain/entities/types.test.ts` - 10 tests
- `src/domain/entities/Organization.ts` - Organization 엔티티
- `src/domain/entities/Organization.test.ts` - 33 tests
- `src/domain/entities/User.ts` - User 엔티티
- `src/domain/entities/User.test.ts` - 22 tests
- `src/domain/entities/AdAccount.ts` - AdAccount 엔티티
- `src/domain/entities/AdAccount.test.ts` - 23 tests
- `src/domain/entities/Campaign.ts` - Campaign 엔티티
- `src/domain/entities/Campaign.test.ts` - 25 tests
- `src/domain/entities/CampaignInsight.ts` - CampaignInsight 엔티티 (8 KPI computed)
- `src/domain/entities/CampaignInsight.test.ts` - 39 tests
- `src/domain/entities/Conversion.ts` - Conversion 엔티티
- `src/domain/entities/Conversion.test.ts` - 21 tests
- `src/domain/repositories/IOrganizationRepository.ts`
- `src/domain/repositories/IUserRepository.ts`
- `src/domain/repositories/IAdAccountRepository.ts`
- `src/domain/repositories/ICampaignRepository.ts`
- `src/domain/repositories/ICampaignInsightRepository.ts`
- `src/domain/repositories/IConversionRepository.ts`

**수정:**
- `src/domain/entities/index.ts` - barrel export 업데이트
- `src/domain/repositories/index.ts` - barrel export 업데이트

### 설계 결정
1. **불변 엔티티**: readonly props + 변경 시 새 인스턴스 반환
2. **Factory 패턴**: create() (검증 O) + reconstruct() (검증 X)
3. **Computed KPIs**: CampaignInsight에 CTR, CPC, CPM, CVR, CPA, ROAS, ROI, Profit
4. **DateRange**: ICampaignInsightRepository에서 정의, IConversionRepository에서 재사용

### Git
- **Commit**: `2b8334b` feat(domain): complete Sprint 1
- **Push**: ✅ origin/main 푸시 완료
- **Files**: 25 files changed, +2,553 lines

### 다음 작업
- [x] Sprint 1 완료 처리 (ROADMAP, CONTEXT 업데이트) ✅
- [x] Git push ✅
- [x] Sprint 2: Authentication & Multi-tenancy 시작 ✅

---

## [11:06] Sprint 2 - Authentication & Multi-tenancy

### 요청
> Sprint 2 전체 구현 - Clerk 인증, 멀티테넌트, RBAC, 초대 시스템, Prisma Repository, 풀 UI

### 수행 내역
| 단계 | 에이전트 | 결과 |
|------|---------|------|
| Phase 1: Foundation | test-writer, implementer x3 | ✅ 27 new tests (201 total) |
| Phase 2: Prisma Repos | implementer x3 (parallel) | ✅ 38 new tests (239 total) |
| Phase 3: Use Cases | implementer x6 (parallel) | ✅ 53 new tests (292 total) |
| Phase 4: Services/DTOs | implementer x2 (parallel) | ✅ 18 new tests (310 total) |
| Phase 5: Clerk Infra | implementer | ✅ 6 new tests (316 total) |
| Phase 6: UI/API | implementer | ✅ 15 routes, full UI |
| Verification | reviewer | ✅ 316 tests, tsc clean, build OK |

### 테스트 결과
- **23 test files, 316 tests, ALL PASSED** (174 Sprint 1 + 142 Sprint 2)
- TypeScript: zero errors
- Build: successful (15 routes)

### 주요 변경
**New files**: ~51 files (entities, repos, use cases, services, DTOs, clerk infra, UI, API routes)
**Modified files**: ~12 files (schema, User entity, barrel exports, layout)
**New packages**: @clerk/nextjs, svix

### 설계 결정
1. Clerk = 인증만, Organization은 커스텀 관리
2. Lazy PrismaClient 초기화 (빌드 타임 에러 방지)
3. force-dynamic for auth pages (SSG 불가)
4. ClerkProvider dynamic prop for build compatibility

### 다음 작업
- [x] Clerk → NextAuth.js 마이그레이션 ✅

---

## [12:00] Clerk → NextAuth.js 완전 마이그레이션

### 요청
> Clerk 인증을 NextAuth.js(Auth.js v5)로 완전 교체. 비용 부담으로 자체 인증 구현.

### 수행 내역
| 단계 | 에이전트 | 결과 |
|------|---------|------|
| Phase 1: 패키지/스키마 | orchestrator | ✅ @clerk/nextjs, svix 제거, next-auth, bcryptjs 설치, schema 변경 |
| Phase 2: Domain Layer | implementer x2 (parallel) | ✅ User 엔티티 변경, RegisterUserUseCase 생성, SyncClerkUser 삭제, 5개 UseCase 수정 |
| Phase 3: Infra Layer | implementer x2 (parallel) | ✅ BcryptPasswordHasher, NextAuth config, PrismaUserRepo 수정, Clerk 인프라 삭제 |
| Phase 4: App Layer | implementer | ✅ AuthDTO, AuthService, OrgService, InvitationService 수정 |
| Phase 5: Auth/Middleware | implementer | ✅ auth.ts (NextAuth session), middleware (JWT token), [...nextauth] route |
| Phase 6: Presentation | implementer | ✅ Sign-in/up 커스텀 UI, Register API, Header, API routes, pages |
| Phase 7: Cleanup | orchestrator | ✅ TS errors 수정, Suspense boundary, build 성공 |

### 테스트 결과
- **23 test files, 322 tests, ALL PASSED**
- 삭제: ~14 tests (SyncClerkUser 8 + ClerkWebhookHandler 6)
- 신규: ~20 tests (RegisterUserUseCase 11 + BcryptPasswordHasher 4 + User entity 5)
- TypeScript: zero errors
- Build: successful (16 routes)

### 주요 변경
**삭제 (6 files)**:
- `src/infrastructure/external/clerk/` (ClerkClient, ClerkWebhookHandler, tests, index)
- `src/domain/usecases/SyncClerkUserUseCase.ts` + `.test.ts`
- `src/app/api/webhooks/clerk/route.ts`
- `src/app/(auth)/sign-in/[[...sign-in]]/` (catch-all dir)
- `src/app/(auth)/sign-up/[[...sign-up]]/` (catch-all dir)

**신규 생성 (10 files)**:
- `src/domain/services/IPasswordHasher.ts` + `index.ts`
- `src/domain/usecases/RegisterUserUseCase.ts` + `.test.ts`
- `src/infrastructure/auth/BcryptPasswordHasher.ts` + `.test.ts` + `index.ts` + `nextauth.config.ts`
- `src/types/next-auth.d.ts`
- `src/app/api/auth/[...nextauth]/route.ts`
- `src/app/api/auth/register/route.ts`
- `src/components/providers/SessionProvider.tsx`

**수정 (Domain - 12 files)**:
- `User.ts` + `.test.ts` (clerkUserId 제거, 새 필드 추가)
- `IUserRepository.ts` (findByClerkUserId 제거)
- `CreateOrganizationUseCase.ts` + `.test.ts` (userId 기반)
- `AcceptInvitationUseCase.ts` + `.test.ts` (userId 기반)
- `ChangeUserRoleUseCase.ts` + `.test.ts` (fixture 수정)
- `InviteUserUseCase.test.ts` (fixture 수정)
- `usecases/index.ts` (export 교체)

**수정 (Infra - 3 files)**:
- `PrismaUserRepository.ts` + `.test.ts` (새 필드 매핑)
- `external/index.ts` (Clerk export 제거)

**수정 (App - 6 files)**:
- `AuthDTO.ts`, `OrganizationDTO.ts`, `InvitationDTO.ts` (clerkUserId 제거)
- `AuthService.ts` + `.test.ts` (resolveUser → getUserById + getUserByEmail)
- `OrganizationService.test.ts`, `InvitationService.test.ts` (fixture 수정)

**수정 (Presentation - 10 files)**:
- `layout.tsx` (SessionProvider), `middleware.ts` (NextAuth JWT), `auth.ts` (NextAuth session)
- Sign-in/up pages (커스텀 UI + Suspense)
- `Header.tsx` (useSession)
- 5 API routes (NextAuth session 사용)
- `onboarding/page.tsx`, `invite/[token]/page.tsx` (NextAuth auth())

**수정 (Config - 2 files)**:
- `prisma/schema.prisma` (clerkUserId 제거, 새 필드 추가, organizationId nullable)
- `package.json` (@clerk/nextjs → next-auth + bcryptjs)

### 설계 결정
1. **JWT Session Strategy** - DB 세션 불필요, 토큰에 userId/role/organizationId 포함
2. **Lazy Initialization** - NextAuth config에서 PrismaClient, PasswordHasher 지연 초기화
3. **NextAuth Prisma Adapter 미사용** - 기존 Repository 패턴 유지 (Clean Architecture)
4. **Credentials + Google OAuth** - 자체 비밀번호 인증 + Google 소셜 로그인
5. **organizationId nullable** - 회원가입 → 온보딩(조직 생성) 플로우 지원
6. **RegisterUserUseCase가 SyncClerkUser 대체** - 웹훅 대신 직접 회원가입
7. **AcceptInvitation/CreateOrg가 userId 기반** - 이미 등록된 유저의 ID로 동작

### 다음 작업
- [x] DB 마이그레이션 (`npx prisma migrate dev`) ✅
- [x] 환경변수 설정 (NEXTAUTH_SECRET, GOOGLE_CLIENT_ID/SECRET) ✅
- [x] Sprint 3: Ad Account 연동 (META API) ✅

---

## [14:00] Sprint 3: META Integration

### 요청
> Sprint 3 META 광고 API 연동 구현

### 수행 내역
| 단계 | 에이전트 | 결과 |
|------|---------|------|
| Phase 1: Foundation | 4 parallel agents | ✅ 76 tests |
| Phase 2: Use Cases | 2 parallel agents | ✅ 52 tests |
| Phase 3: App Services | 2 parallel agents | ✅ 19 tests |
| Phase 4: API Routes | 3 parallel agents | ✅ 완료 |
| Phase 5: UI | 1 agent | ✅ 완료 |
| Phase 6: Verification | orchestrator | ✅ 469 tests, tsc OK, build OK |

### 변경 파일 (~40 new files)
**Domain Services (3 interfaces)**
- `src/domain/services/IMetaApiClient.ts` (생성)
- `src/domain/services/ITokenEncryption.ts` (생성)
- `src/domain/services/ICacheService.ts` (생성)

**Use Cases (4 + tests)**
- `src/domain/usecases/ConnectMetaAdAccountUseCase.ts` (생성)
- `src/domain/usecases/RefreshMetaTokenUseCase.ts` (생성)
- `src/domain/usecases/SyncMetaCampaignsUseCase.ts` (생성)
- `src/domain/usecases/SyncMetaInsightsUseCase.ts` (생성)

**Infrastructure (repos, encryption, cache, META client)**
- `src/infrastructure/repositories/PrismaAdAccountRepository.ts` (생성)
- `src/infrastructure/repositories/PrismaCampaignRepository.ts` (생성)
- `src/infrastructure/repositories/PrismaCampaignInsightRepository.ts` (생성)
- `src/infrastructure/encryption/AesTokenEncryption.ts` (생성)
- `src/infrastructure/cache/InMemoryCacheService.ts` (생성)
- `src/infrastructure/external/meta/MetaApiClient.ts` (생성)

**Application Services (2 + DTOs)**
- `src/application/services/MetaAdAccountService.ts` (생성)
- `src/application/services/MetaSyncService.ts` (생성)
- `src/application/dto/MetaDTO.ts` (생성)

**API Routes (6)**
- `src/app/api/meta/auth/route.ts` (생성)
- `src/app/api/meta/auth/callback/route.ts` (생성)
- `src/app/api/meta/accounts/route.ts` (생성)
- `src/app/api/meta/sync/campaigns/route.ts` (생성)
- `src/app/api/meta/sync/insights/route.ts` (생성)
- `src/app/api/cron/sync-meta/route.ts` (생성)

**UI Components (5)**
- `src/app/(dashboard)/integrations/page.tsx` (생성)
- `src/app/(dashboard)/integrations/meta/callback/page.tsx` (생성)
- `src/components/integrations/MetaConnectButton.tsx` (생성)
- `src/components/integrations/AdAccountList.tsx` (생성)
- `src/components/integrations/SyncStatusCard.tsx` (생성)

**Config**
- `vercel.json` (생성)
- `src/components/layout/Sidebar.tsx` (수정 - Integrations 메뉴 추가)

### 다음 작업
- [x] Sprint 4: Dashboard Data Visualization ✅

---

## [16:00] Sprint 4: Dashboard Data Visualization

### 요청
> 동기화된 광고 성과 데이터를 대시보드에 시각화 (Recharts)

### 수행 내역
| 단계 | 에이전트 | 결과 |
|------|---------|------|
| Phase 0: Setup | orchestrator | ✅ recharts 설치 |
| Phase 1: Use Cases | 2 배경 에이전트 (병렬) | ✅ GetDashboardOverview (14t), GetCampaignPerformance (10t) |
| Phase 2: DTO + Service | 1 배경 에이전트 + 직접 | ✅ DashboardDTO + DashboardService (8t) |
| Phase 3: Formatters | 1 배경 에이전트 | ✅ 6 formatters (15t) |
| Phase 4: UI Components | 직접 작성 | ✅ 7 components (69t) |
| Phase 5: Page Assembly | 직접 작성 | ✅ Hooks + DashboardContent + API routes |
| Phase 6: Verification | orchestrator | ✅ 585 tests, tsc OK, build OK |

### 주요 결정
- Recharts 선택 (Tremor 대신 - 경량, React 19 호환, 유연)
- Recharts 테스트: `vi.mock('recharts')` → simple div 반환 (jsdom canvas/SVG 이슈 회피)
- `PieLabelRenderProps.percent` optional → `props.percent ?? 0`
- `Tooltip.labelFormatter` → `(label) => formatDate(String(label))`

### 변경 파일 (~28 new files)
**Domain Use Cases (2 + tests)**
- `src/domain/usecases/GetDashboardOverviewUseCase.ts` + `.test.ts`
- `src/domain/usecases/GetCampaignPerformanceUseCase.ts` + `.test.ts`
- `src/domain/usecases/index.ts` (수정 - barrel export)

**Application (DTO + Service + test)**
- `src/application/dto/DashboardDTO.ts`
- `src/application/dto/index.ts` (수정)
- `src/application/services/DashboardService.ts` + `.test.ts`
- `src/application/services/index.ts` (수정)

**Library**
- `src/lib/formatters.ts` + `.test.ts`

**Hooks (2 + tests)**
- `src/hooks/useDateRange.ts` + `.test.ts`
- `src/hooks/useDashboardData.ts` + `.test.ts`
- `src/hooks/index.ts` (수정)

**UI Components (7 + tests)**
- `src/components/dashboard/KpiCard.tsx` + `.test.tsx`
- `src/components/dashboard/DateRangeFilter.tsx` + `.test.tsx`
- `src/components/dashboard/SpendTrendChart.tsx` + `.test.tsx`
- `src/components/dashboard/CampaignComparisonChart.tsx` + `.test.tsx`
- `src/components/dashboard/SpendDistributionChart.tsx` + `.test.tsx`
- `src/components/dashboard/CampaignPerformanceTable.tsx` + `.test.tsx`
- `src/components/dashboard/DashboardContent.tsx` + `.test.tsx`
- `src/components/dashboard/index.ts` (생성)

**API Routes (2)**
- `src/app/api/dashboard/overview/route.ts`
- `src/app/api/dashboard/campaigns/route.ts`

**Page**
- `src/app/(dashboard)/dashboard/page.tsx` (수정 - DashboardContent 연결)

### 테스트 결과
- 신규: 116 tests
- 전체: 585 tests, ALL PASSED
- TypeScript: 0 errors
- Build: ✅ Passing

### 다음 작업
- [ ] Sprint 5: Additional Platforms (사용자 지시 대기)

---

## [17:00] 문서 업데이트 루틴 수정

### 요청
> 커맨드 파일에 작업 완료 후 문서 업데이트 루틴이 없어 기록이 안 됨

### 진단
- **문제 1 (커맨드)**: `/new-feature`, `/fix-bug`, `/refactor` 모두 Documentation Update 단계 없음
- **문제 2 (문서 상태)**: STATUS.md는 Sprint 0에서 멈춤, CONTEXT.md/ROADMAP.md는 Sprint 3까지만

### 수정 내역
| 파일 | 변경 |
|------|------|
| `.claude/commands/new-feature.md` | 9단계 Documentation Update 추가 + 상세 가이드 |
| `.claude/commands/fix-bug.md` | 6단계 Documentation Update 추가 |
| `.claude/commands/refactor.md` | 6단계 Documentation Update 추가 |
| `.claude/CONTEXT.md` | Sprint 4 완료 상태로 전면 업데이트 |
| `.claude/STATUS.md` | Sprint 0-4 전체 반영, 메트릭 갱신 |
| `.claude/ROADMAP.md` | Sprint 4 전체 ✅ Done, Changelog 추가 |
| `.claude/logs/2026-02-10.md` | Sprint 4 + 문서 수정 내역 추가 |

### 다음 작업
- [x] Git 배포 루틴 추가 ✅

---

## [17:30] Git 배포 루틴 추가

### 요청
> Sprint 완료 시 GitHub 배포(commit + push)까지 자동으로 처리되게 해달라

### 진단
- 커맨드 3개 모두 Git commit/push 단계가 없음
- ORCHESTRATOR.md에 Git 규칙은 있지만 Sprint 완료 배포 프로세스가 없음

### 수정 내역
| 파일 | 변경 |
|------|------|
| `.claude/commands/new-feature.md` | **10단계 Git Commit & Push 추가** - 태스크 단위 + Sprint 완료 배포 2레벨 |
| `.claude/commands/fix-bug.md` | **7단계 Git Commit & Push 추가** |
| `.claude/commands/refactor.md` | **7단계 Git Commit & Push 추가** |
| `.claude/ORCHESTRATOR.md` | Git Workflow 전면 개편 - Level 1(태스크) + Level 2(Sprint 배포) |

### 추가된 프로세스
```
Level 1: 태스크 커밋 (Sprint 진행 중)
  → vitest + tsc → 변경 파일 스테이징 → feat(scope) 커밋

Level 2: Sprint 완료 배포 (모든 태스크 ✅)
  → vitest + tsc + build → 문서 확인 → git add -A → Sprint 커밋 → push
```

### Sprint 완료 판별 기준
1. 모든 태스크 ✅ Done
2. vitest → ALL PASSED
3. tsc → 0 errors
4. build → 성공
5. 문서 4종 업데이트 완료

### 다음 작업
- [x] Sprint 5 진행 ✅

---

## [15:30] Sprint 5: Additional Platforms (Multi-Platform Adapter)

### 요청
> META 전용 광고 연동을 Platform Adapter 패턴으로 일반화하고, Google Ads / TikTok Ads / Naver 검색광고를 추가

### 수행 내역
| 단계 | 에이전트 | 결과 |
|------|---------|------|
| Phase 1A: Interfaces | orchestrator 직접 | ✅ IAdPlatformClient, IPlatformAdapterRegistry |
| Phase 1B: Use Cases | 4 parallel agents | ✅ 79 tests (Connect, SyncCampaigns, SyncInsights, RefreshToken) |
| Phase 1C: MetaAdapter+Registry | 1 parallel agent | ✅ 23 tests |
| Phase 1D: App Services | 1 agent | ✅ 22 tests (AdAccountService, SyncService) |
| Phase 2: Google Ads | 1 parallel agent | ✅ 56 tests (ApiClient, Adapter, routes, UI) |
| Phase 3: TikTok Ads | 1 parallel agent | ✅ 46 tests (ApiClient, Adapter, routes, UI) |
| Phase 4: Naver Ads | 1 parallel agent | ✅ 44 tests (ApiClient, Adapter, form, routes) |
| Phase 5A: Dashboard Filter | 1 parallel agent | ✅ 43 tests (PlatformFilter, PlatformBadge, use case updates) |
| Phase 5B: Cron+Integrations | 1 parallel agent | ✅ Routes + integrations page |
| Phase 6: Verification | orchestrator | ✅ 814 tests, tsc 0 errors, build OK |

### 테스트 결과
- **65 test files, 814 tests, ALL PASSED** (585 Sprint 4 + 229 Sprint 5)
- TypeScript: zero errors
- Build: successful (30 routes)

### 주요 설계 결정
1. **Platform Adapter Pattern**: IAdPlatformClient 통합 인터페이스 + IPlatformAdapterRegistry 팩토리
2. **Normalized Data Types**: 각 어댑터가 플랫폼별 데이터를 도메인 호환 형식으로 정규화
3. **Naver API Key Auth**: JSON credentials `{apiKey, apiSecret, customerId}` 단일 암호화 저장
4. **기존 META 코드 유지**: deprecated 아닌 병행 운영 (기존 use cases + 새 generalized)
5. **Dashboard Platform Filter**: 기존 대시보드에 platform 파라미터 추가

### 변경 파일 (~56 new, ~16 modified)

**Domain (2 interfaces + 4 use cases + tests)**
- `src/domain/services/IAdPlatformClient.ts` (생성)
- `src/domain/services/IPlatformAdapterRegistry.ts` (생성)
- `src/domain/usecases/ConnectAdAccountUseCase.ts` + `.test.ts` (생성)
- `src/domain/usecases/SyncCampaignsUseCase.ts` + `.test.ts` (생성)
- `src/domain/usecases/SyncInsightsUseCase.ts` + `.test.ts` (생성)
- `src/domain/usecases/RefreshTokenUseCase.ts` + `.test.ts` (생성)

**Infrastructure (3 platform adapters + registry + 3 API clients)**
- `src/infrastructure/external/meta/MetaPlatformAdapter.ts` + `.test.ts` (생성)
- `src/infrastructure/external/google/GoogleAdsApiClient.ts` + `.test.ts` (생성)
- `src/infrastructure/external/google/GoogleAdsPlatformAdapter.ts` + `.test.ts` (생성)
- `src/infrastructure/external/tiktok/TikTokAdsApiClient.ts` + `.test.ts` (생성)
- `src/infrastructure/external/tiktok/TikTokAdsPlatformAdapter.ts` + `.test.ts` (생성)
- `src/infrastructure/external/naver/NaverAdsApiClient.ts` + `.test.ts` (생성)
- `src/infrastructure/external/naver/NaverAdsPlatformAdapter.ts` + `.test.ts` (생성)
- `src/infrastructure/external/PlatformAdapterRegistry.ts` + `.test.ts` (생성)

**Application (2 services + DTO)**
- `src/application/services/AdAccountService.ts` + `.test.ts` (생성)
- `src/application/services/SyncService.ts` + `.test.ts` (생성)
- `src/application/dto/AdAccountDTO.ts` (생성)

**API Routes (10 new + 2 modified)**
- `src/app/api/google/auth/route.ts` (생성)
- `src/app/api/google/auth/callback/route.ts` (생성)
- `src/app/api/google/accounts/route.ts` (생성)
- `src/app/api/google/sync/campaigns/route.ts` (생성)
- `src/app/api/tiktok/auth/route.ts` (생성)
- `src/app/api/tiktok/auth/callback/route.ts` (생성)
- `src/app/api/tiktok/accounts/route.ts` (생성)
- `src/app/api/tiktok/sync/campaigns/route.ts` (생성)
- `src/app/api/naver/accounts/route.ts` (생성)
- `src/app/api/naver/sync/campaigns/route.ts` (생성)
- `src/app/api/cron/sync-all/route.ts` (생성)
- `src/app/api/accounts/route.ts` (생성)
- `src/app/api/dashboard/overview/route.ts` (수정 - platform param)
- `src/app/api/dashboard/campaigns/route.ts` (수정 - platform param)

**UI Components (7 new + 3 modified)**
- `src/components/integrations/GoogleConnectButton.tsx` (생성)
- `src/components/integrations/TikTokConnectButton.tsx` (생성)
- `src/components/integrations/NaverConnectForm.tsx` + `.test.tsx` (생성)
- `src/components/dashboard/PlatformFilter.tsx` + `.test.tsx` (생성)
- `src/components/dashboard/PlatformBadge.tsx` + `.test.tsx` (생성)
- `src/app/(dashboard)/integrations/google/callback/page.tsx` (생성)
- `src/app/(dashboard)/integrations/tiktok/callback/page.tsx` (생성)
- `src/app/(dashboard)/integrations/page.tsx` (수정 - 4개 플랫폼)
- `src/components/dashboard/DashboardContent.tsx` (수정 - PlatformFilter)
- `src/components/dashboard/CampaignPerformanceTable.tsx` (수정 - Platform column)

**Dashboard Use Cases (2 modified)**
- `src/domain/usecases/GetDashboardOverviewUseCase.ts` + `.test.ts` (수정 - platform filter)
- `src/domain/usecases/GetCampaignPerformanceUseCase.ts` + `.test.ts` (수정 - platform filter)

**Hooks**
- `src/hooks/useDashboardData.ts` (수정 - platform parameter)

**Barrel Exports (6 modified)**
- `src/domain/services/index.ts`, `src/domain/usecases/index.ts`
- `src/application/services/index.ts`, `src/application/dto/index.ts`
- `src/infrastructure/external/index.ts`, `src/infrastructure/external/meta/index.ts`
- `src/infrastructure/external/google/index.ts`, `src/infrastructure/external/tiktok/index.ts`, `src/infrastructure/external/naver/index.ts`

### 다음 작업
- [x] Sprint 6: Billing & SaaS ✅

---

## [17:00] Sprint 6: Billing & SaaS

### 요청
> Stripe 결제 연동, 구독 플랜 관리, 플랜별 기능 제한 구현

### 수행 내역
| 단계 | Phase | 에이전트 | 결과 |
|------|-------|---------|------|
| 1 | Domain Foundation | 3 parallel | ✅ Schema, Entities (39t), Interfaces, PlanLimits |
| 2 | Use Cases | 5 parallel | ✅ 66 tests (Checkout, Webhook, Portal, GetSub, CheckFeature) |
| 3 | Infrastructure | 3 parallel | ✅ 30 tests (StripeGateway, PrismaRepos, PriceConfig) |
| 4 | App Layer + API | 2 parallel | ✅ 12 tests (BillingService, 5 API routes) |
| 5 | Feature Gating | 1 agent | ✅ ~7 tests (ConnectAdAccount limits, changePlan, cron) |
| 6 | UI Components | 2 parallel | ✅ 27 tests (5 components, 2 hooks, 2 pages, sidebar) |
| 7 | Verification | orchestrator | ✅ 996 tests, 0 TS errors, build success |

### 테스트 결과
- **83 test files, 996 tests, ALL PASSED** (814 Sprint 5 + 182 Sprint 6)
- TypeScript: zero errors
- Build: successful

### 주요 설계 결정
1. **IPaymentGateway 도메인 인터페이스** - Stripe 직접 의존 없이 Clean Architecture 유지
2. **Stripe Checkout (redirect)** - PCI 컴플라이언스 자동
3. **Stripe Customer Portal** - 구독 관리 위임
4. **Webhook 멱등성** - BillingEvent 테이블, stripeEventId unique 체크
5. **Organization 단위 구독** - 개별 사용자 아닌 조직 단위
6. **PlanLimits 확장** - allowedPlatforms, hasAutoSync, hasExports 추가
7. **Feature Gating** - ConnectAdAccountUseCase에 플랜 제한 체크 삽입

### 변경 파일 (~50 new, ~10 modified)

**Domain Layer:**
- Subscription entity + BillingEvent entity (+ tests)
- ISubscriptionRepository, IBillingEventRepository, IPaymentGateway
- 5 use cases: CreateCheckoutSession, HandleStripeWebhook, CreatePortalSession, GetSubscription, CheckFeatureAccess
- Organization.changePlan(), ConnectAdAccountUseCase plan limits
- types.ts: SubscriptionStatus enum, PlanLimits extension

**Infrastructure:**
- StripePaymentGateway + stripePriceConfig
- PrismaSubscriptionRepository, PrismaBillingEventRepository

**Application:**
- BillingDTO, BillingService

**API Routes (6):**
- /api/billing/checkout, /portal, /subscription, /usage
- /api/webhooks/stripe
- Shared getBillingService factory

**UI (12 files):**
- PricingCard, PricingTable, CurrentPlanBadge, UsageMeter, UpgradePrompt
- useSubscription, usePlanLimits hooks
- /pricing page, /settings/billing page
- Sidebar: Billing nav item

**Modified:**
- prisma/schema.prisma, middleware.ts, cron/sync-all/route.ts

### 다음 작업
- [ ] Sprint 7 계획 수립

---

## [17:00] Sprint 6 - Billing & SaaS

### 요청
> Sprint 6: Stripe 결제 연동, 구독 플랜 관리, 플랜별 기능 제한, 빌링 UI 구현

### 수행 내역
| 단계 | 에이전트 | 결과 |
|------|---------|------|
| 스키마 설계 | db-designer | ✅ Subscription + BillingEvent 모델 |
| 엔티티 | test-writer → implementer | ✅ Subscription (26 tests) + BillingEvent (13 tests) |
| 인터페이스 | architect | ✅ ISubscriptionRepo + IBillingEventRepo + IPaymentGateway + PlanLimits 확장 |
| Use Cases | test-writer → implementer | ✅ 5 UC (CreateCheckout 14t, HandleWebhook 20t, Portal 8t, GetSub 8t, CheckAccess 16t) |
| Infrastructure | api-integrator → implementer | ✅ StripePaymentGateway (17t) + PrismaRepos (13t) + stripePriceConfig |
| App Layer | implementer | ✅ BillingService (12t) + BillingDTO + 5 API routes |
| Feature Gating | implementer | ✅ ConnectAdAccount limits + cron FREE skip + Organization.changePlan |
| UI | implementer | ✅ 5 components (17t) + 2 hooks (10t) + 2 pages + sidebar |
| TypeScript | - | ✅ 0 errors |
| Build | - | ✅ 성공 |

### 변경 파일
**생성 (~49 files):**
- `src/domain/entities/Subscription.ts` + test
- `src/domain/entities/BillingEvent.ts` + test
- `src/domain/repositories/ISubscriptionRepository.ts`
- `src/domain/repositories/IBillingEventRepository.ts`
- `src/domain/services/IPaymentGateway.ts`
- `src/domain/usecases/CreateCheckoutSessionUseCase.ts` + test
- `src/domain/usecases/HandleStripeWebhookUseCase.ts` + test
- `src/domain/usecases/CreatePortalSessionUseCase.ts` + test
- `src/domain/usecases/GetSubscriptionUseCase.ts` + test
- `src/domain/usecases/CheckFeatureAccessUseCase.ts` + test
- `src/infrastructure/external/stripe/StripePaymentGateway.ts` + test
- `src/infrastructure/external/stripe/stripePriceConfig.ts`
- `src/infrastructure/repositories/PrismaSubscriptionRepository.ts` + test
- `src/infrastructure/repositories/PrismaBillingEventRepository.ts` + test
- `src/application/dto/BillingDTO.ts`
- `src/application/services/BillingService.ts` + test
- `src/app/api/billing/_shared/getBillingService.ts`
- `src/app/api/billing/checkout/route.ts`
- `src/app/api/billing/portal/route.ts`
- `src/app/api/billing/subscription/route.ts`
- `src/app/api/billing/usage/route.ts`
- `src/app/api/webhooks/stripe/route.ts`
- `src/components/billing/PricingCard.tsx` + test
- `src/components/billing/PricingTable.tsx` + test
- `src/components/billing/CurrentPlanBadge.tsx` + test
- `src/components/billing/UsageMeter.tsx` + test
- `src/components/billing/UpgradePrompt.tsx` + test
- `src/hooks/useSubscription.ts` + test
- `src/hooks/usePlanLimits.ts` + test
- `src/app/(marketing)/pricing/page.tsx`
- `src/app/(dashboard)/settings/billing/page.tsx`

**수정 (~12 files):**
- `prisma/schema.prisma` - Subscription, BillingEvent 모델 추가
- `src/domain/entities/types.ts` - SubscriptionStatus enum, PlanLimits 확장
- `src/domain/entities/Organization.ts` - changePlan() 추가
- `src/domain/usecases/ConnectAdAccountUseCase.ts` - 플랜 제한 체크
- `src/middleware.ts` - publicRoutes 추가
- `src/components/layout/Sidebar.tsx` - billing 메뉴 추가
- `src/app/api/cron/sync-all/route.ts` - FREE 플랜 건너뜀
- Barrel exports: entities, repositories, services, usecases, application

### 테스트 결과
- 신규: 182 tests
- 전체: 996 tests, 83 files, ALL PASSED

### 다음 작업
- [x] Sprint 7: Production & Polish ✅

---

## [18:00] Sprint 7: Production & Polish

### 요청
> 프로덕션 배포를 위한 안정화: 구조화된 에러 처리, 로깅, 성능 최적화, E2E 테스트, 배포 설정, 모니터링, 문서화

### 수행 내역
| 단계 | Phase | 에이전트 | 결과 |
|------|-------|---------|------|
| 1A | Domain Error Classes | 1 agent | ✅ 7 error classes + 15 tests |
| 1B | Entity Migration | 1 background agent | ✅ 9 entities migrated to ValidationError |
| 1B | Use Case Migration | 1 background agent | ✅ 21 use cases migrated to custom errors |
| 1B | Auth Migration | direct | ✅ auth.ts → UnauthorizedError/ForbiddenError |
| 1C | API Error Handler | direct | ✅ handleApiError + 11 tests |
| 1D | API Route Migration | 1 background agent | ✅ ~31 routes migrated |
| 1E | Error Boundaries | direct | ✅ error.tsx + ErrorBoundary + 4 tests |
| 2A | ILogger Interface | direct | ✅ domain service interface |
| 2B | PinoLogger | direct | ✅ implementation + 7 tests |
| 2C | withLogging | direct | ✅ API wrapper + 5 tests |
| 2D | Logging Integration | direct | ✅ apiErrorHandler, cron, billing |
| 3A | QueryProvider | direct | ✅ React Query provider + layout |
| 3B | Hook Migration | direct | ✅ 3 hooks → useQuery (31 tests) |
| 3C | Loading States | direct | ✅ 3 loading.tsx skeletons |
| 3D | Next.js Config | direct | ✅ optimizePackageImports + security headers |
| 3E | PrismaClient Singleton | 1 haiku agent | ✅ 6 files fixed |
| 4A | Playwright Config | direct | ✅ playwright.config.ts |
| 4B | E2E Tests | direct | ✅ 5 spec files (26 tests) |
| 4C | CI Integration | direct | ✅ e2e job in ci.yml |
| 5A | Health Check | direct | ✅ /api/health + 3 tests |
| 5B | Vercel Config | direct | ✅ sync-meta → sync-all |
| 5C | Env Validation | direct | ✅ requireEnv + 7 tests |
| 6A | Sentry Config | direct | ✅ client/server/edge configs |
| 6B | Error Handler Integration | direct | ✅ Sentry.captureException for 500s |
| 6C | Global Error Page | direct | ✅ global-error.tsx |
| 7A | API Documentation | 1 background agent | ✅ docs/api.md |
| 7B | README | 1 background agent | ✅ README.md |
| 7C | ADRs | 1 background agent | ✅ 4 ADR documents |

### 테스트 결과
- **90 test files, 1057 tests, ALL PASSED** (996 Sprint 6 + 61 Sprint 7)
- TypeScript: zero errors
- Build: successful
- New tests: DomainErrors(15) + apiErrorHandler(11) + ErrorBoundary(4) + PinoLogger(7) + withLogging(5) + health(3) + env(7) + hooks(updated)

### npm 패키지 추가
- `pino` - 구조화 로깅
- `@tanstack/react-query` - 클라이언트 데이터 캐싱
- `@sentry/nextjs` - 에러 모니터링
- `pino-pretty` (dev) - 개발환경 로그 포맷
- `@playwright/test` (dev) - E2E 테스트

### 변경 파일 요약
**생성 (~35 files):**
- `src/domain/errors/` - 9 files (7 error classes + test + barrel)
- `src/domain/services/ILogger.ts` - 로거 인터페이스
- `src/infrastructure/logging/` - 3 files (PinoLogger + test + index)
- `src/lib/apiErrorHandler.ts` + test
- `src/lib/withLogging.ts` + test
- `src/lib/env.ts` + test
- `src/components/ErrorBoundary.tsx` + test
- `src/components/providers/QueryProvider.tsx`
- `src/app/error.tsx`, `src/app/(dashboard)/error.tsx`, `src/app/global-error.tsx`
- `src/app/(dashboard)/*/loading.tsx` - 3 skeleton pages
- `src/app/api/health/route.ts` + test
- `src/instrumentation.ts`
- `sentry.client.config.ts`, `sentry.server.config.ts`, `sentry.edge.config.ts`
- `playwright.config.ts`
- `e2e/` - 5 spec files
- `docs/api.md`, `docs/adr/` - 4 ADR files

**수정 (~74 files):**
- 9 domain entities → ValidationError
- 21 domain use cases → custom errors
- ~31 API routes → handleApiError
- 3 hooks → React Query
- `src/lib/auth.ts` → UnauthorizedError/ForbiddenError
- `next.config.ts` → Sentry + security headers + optimizePackageImports
- `vercel.json` → sync-all
- `.github/workflows/ci.yml` → e2e job
- `package.json` → new scripts
- `src/app/layout.tsx` → QueryProvider
- 6 files → getPrisma() singleton
- `README.md` → comprehensive update

### 다음 작업
- [ ] 프로덕션 배포
